language: ruby
rvm:
  - 2.1 # git.ruby-lang.org is debian 8 (jessie), ruby 2.1.5p273
branches:
  only:
    - master
before_install:
  - git clone --depth=3 https://github.com/ruby/ruby

  # Install dummy `sendmail` for testing commit-email.rb
  - |-
    echo "#!/usr/bin/env ruby
          p ARGV
          puts STDIN.read" > ./sendmail
    chmod +x ./sendmail
    sudo mv ./sendmail /usr/sbin/sendmail

script:
  - |-
    cd ./ruby &&
    ../bin/commit-email.rb ./ cvs-admin@ruby-lang.org \
      $(git rev-parse HEAD^) $(git rev-parse HEAD) refs/heads/trunk \
      --name Ruby \
      --viewer-uri "https://git.ruby-lang.org/ruby.git/commit/?id=" \
      -r https://svn.ruby-lang.org/repos/ruby \
      --rss-path /tmp/ruby.rdf \
      --rss-uri https://svn.ruby-lang.org/rss/ruby.rdf \
      --error-to cvs-admin@ruby-lang.org
